'use client';

import React, { createContext, useContext, useEffect, useState } from 'react';

type Lang = 'tr' | 'en';

const dict: Record<Lang, Record<string, string>> = {
  tr: {
    app_title: 'Rapor Uygulaması',
    welcome_subtitle: 'Hoş geldiniz! Giriş yapın',
    email: 'Email',
    password: 'Şifre',
    login: 'Giriş Yap',
    remember_me: 'Beni hatırla',
    no_account: 'Hesabınız yok mu? Kayıt olun',
    reports: 'Raporlar',
    today: 'Bugün',
    yesterday: 'Dün',
    this_week: 'Bu Hafta',
    last_7_days: 'Son 7 Gün',
    this_month: 'Bu Ay',
    last_month: 'Geçen Ay',
    custom_date: 'Özel Tarih',
    range_label_total: 'Genel Toplam',
    performance_report: 'Performans Raporu',
    performance_report_desc: 'Personel, ürün ve süre performansı',
    orders_count: 'Adisyon Sayısı',
    avg_ticket: 'Ortalama Fiş',
    avg_duration_minutes: 'Ortalama Süre (dk)',
    over60_count: '60 dk üzeri',
    waiter_performance: 'Garson Performansı',
    product_performance: 'Ürün Performansı',
    group_performance: 'Grup Performansı',
    open_closed_total: 'Açık ve Kapalı Adisyonlar',
    closed_total: 'Kapalı Adisyonlar',
    open_orders: 'Açık Adisyon',
    closed_orders: 'Kapalı Adisyon',
    discount: 'İskonto',
    branch: 'Şube',
    online: 'online',
    offline: 'offline',
    count_orders: 'adet adisyon',
    filter_table_no: 'Masa No',
    date: 'Tarih',
    payment: 'Ödeme',
    waiter: 'Garson',
    opening: 'Açılış',
    closing: 'Kapanış',
    customer: 'Müşteri',
    duration: 'Süre',
    elapsed: 'Geçen',
    not_found: 'Kayıt bulunamadı',
    load_more: 'Daha Fazla Yükle',
    showing: 'kayıt gösteriliyor',
    page: 'Sayfa',
    search_product: 'Ürün ara',
    amount: 'Tutar',
    quantity: 'Adet',
    average_label: 'Ortalama',
    total_sales: 'Toplam Satış',
    product_types: 'Ürün Çeşidi',
    all_products: 'Tüm Ürünler',
    products: 'Ürünler',
    no_products: 'Ürün bulunamadı',
    period_no_sales_products: 'Bu dönem için satış kaydı bulunamadı',
    groups: 'Gruplar',
    payments_title: 'Ödeme Tipleri',
    total_payment: 'Toplam Ödeme',
    payment_types_desc: 'Ödeme yöntemlerine göre analiz',
    payment_types_count: 'farklı ödeme tipi',
    distribution: 'Dağılım',
    detailed_info: 'Detaylı Bilgi',
    transaction: 'işlem',
    sales_chart: 'Satış Grafiği',
    sales_chart_desc: 'Satış trendlerini görselleştirin',
    product_sales: 'Ürün Bazlı Satışlar',
    product_sales_desc: 'En çok satılan ürünleri görün',
    daily_sales_chart: 'Günlük Satış Grafiği',
    daily_details: 'Günlük Detaylar',
    no_data_selected_range: 'Seçili tarih aralığında veri bulunamadı',
    filter_title: 'Filtrele',
    table_no_label: 'Masa Numarası:',
    select: 'Seç',
    clear_filters: 'Filtreleri Temizle',
    open_orders_title: 'Açık Adisyonlar',
    order_detail: 'Adisyon Detayı',
    order_no: 'Adisyon No',
    order_type: 'Sipariş Tipi:',
    order_place: 'Sipyer:',
    order_type_adisyon: 'Adisyon',
    order_type_paket: 'Paket',
    order_type_hizli: 'Hızlı Satış',
    subtotal: 'Ara Toplam',
    total_paid: 'Ödenen Tutar',
    cancelled_report_title: 'İptal, İade ve İkram Raporu',
    cancelled_report_desc: 'İptal, iade ve ikram kayıtlarını inceleyin',
    total_cancelled_amount: 'Toplam İptal Edilen Miktar',
    total_cancelled_count: 'adet iptal',
    all: 'Tümü',
    cancel: 'İptal',
    return: 'İade',
    compliment: 'İkram',
    all_cancellations: 'Tüm İptaller',
    no_cancellations_title: 'Hiç İptal Yok!',
    no_cancellations_text: 'Bu dönem için iptal edilen ürün bulunmamaktadır',
    info: 'Bilgi',
    no_order_info: 'Bu kayıt için adisyon bilgisi bulunamadı',
    groups_not_found: 'Grup bulunamadı',
    start_date: 'Başlangıç Tarihi',
    end_date: 'Bitiş Tarihi',
    courier_tracking_report: 'Paketçi Takip Raporu',
    courier_tracking_desc: 'Kurye giriş çıkış saatleri ve süre takibi',
    courier: 'Kurye',
    departure: 'Çıkış',
    return_time: 'Dönüş',
    duration_min: 'Süre (dk)',
    status: 'Durum',
    on_road: 'Yolda',
    returned: 'Döndü',
    branch_management: 'Şube Yönetimi',
    select_branch: 'Şube Seçiniz',
    no_branch: 'Şube Yok',
    other_reports: 'Diğer Raporlar',
    personnel: 'Personel',
    personnel_desc: 'Garson performans',
    payment_types_card_desc: 'Nakit, Kredi Kartı',
    hourly_sales: 'Saatlik Satış',
    hourly_sales_desc: 'Günün yoğun saatleri',
    cancelled_items: 'İptal, İade ve İkram',
    cancelled_items_desc: 'İptal, iade ve ikramlar',
    product_groups: 'Ürün Grupları',
    product_groups_desc: 'Kategori bazlı',
    courier_tracking_card_desc: 'Paket süreleri',
    branch_selection: 'Şube Seçimi',
    select_date_range: 'Tarih Aralığı Seç',
    apply: 'Uygula',
    table: 'Masa',
    closing_time: 'Kapanış',
    date_label: 'TARİH',
    time_label: 'SAAT',
    waiter_label: 'GARSON',
    orders_title: 'Siparişler',
    item_count: 'Kalem',
    piece: 'adet',
    person_count: 'Kişi Sayısı',
    payment_method: 'Ödeme Yöntemi',
    loading: 'Yükleniyor...',
    edit_branch: 'Şube Düzenle',
    add_new_branch: 'Yeni Şube Ekle',
    branch_name: 'Şube Adı',
    host: 'Host',
    port: 'Port',
    db_name: 'DB Adı',
    kasa_no: 'Kasa No',
    db_user: 'DB Kullanıcı',
    db_password: 'DB Şifre',
    save: 'Kaydet',
    operation_failed: 'İşlem başarısız oldu.',
    confirm_delete_branch: 'Bu şubeyi silmek istediğinize emin misiniz?',
    delete_failed: 'Silme işlemi başarısız.',
    courier_tracking: 'Kurye Takip',
    product_group_sales: 'Ürün Grubu Satışları',
    product_group: 'Ürün Grubu',
    product_name: 'Ürün Adı',
    total_orders: 'toplam adisyon',
    basket_average: 'sepet ortalaması',
    average_duration: 'ortalama süre',
    long_duration: 'uzun süren',
    orders: 'Adisyon',
    performance_short: 'Perf.',
    product: 'Ürün',
    group: 'Grup',
    distribution_chart: 'Dağılım Grafiği',
    sales_chart_title: 'Satış Grafiği',
    sales_chart_subtitle: 'Zaman bazlı satış performansı',
    reason: 'Sebep',
    type: 'Tip',
    login_failed: 'Giriş başarısız. Lütfen bilgilerinizi kontrol edin.',
    wrong_password: 'Girdiğiniz şifre hatalı',
    user_not_found: 'Kullanıcı bulunamadı',
    register: 'Kayıt Ol',
    discount_title: 'İskonto Raporu',
    total_discount: 'Toplam İskonto',
    no_discounts: 'İskonto bulunamadı',
    discount_records: 'iskonto kaydı',
    order_total: 'Sipariş Toplamı',
    net_total: 'Net Toplam',
    close: 'Kapat',
    time: 'Saat',
    discount_report: 'İskonto Raporu',
    discount_report_desc: 'İndirim yapılan adisyonlar',
    unpayable_report: 'Ödenmez Raporu',
    unpayable_report_desc: 'Ödenmez adisyonlar',
    debts_report: 'Borca Atılanlar',
    debts_report_desc: 'Borca atılan adisyonlar',
    quick_stats: 'Hızlı İstatistikler',
    view_details: 'Detayları Gör',
  },
  en: {
    app_title: 'Reports App',
    welcome_subtitle: 'Welcome! Sign in',
    email: 'Email',
    password: 'Password',
    login: 'Sign In',
    remember_me: 'Remember me',
    no_account: 'No account? Register',
    reports: 'Reports',
    today: 'Today',
    yesterday: 'Yesterday',
    this_week: 'This Week',
    last_7_days: 'Last 7 Days',
    this_month: 'This Month',
    last_month: 'Last Month',
    custom_date: 'Custom Date',
    range_label_total: 'Grand Total',
    performance_report: 'Performance Report',
    performance_report_desc: 'Staff, product and duration performance',
    orders_count: 'Order Count',
    avg_ticket: 'Average Ticket',
    avg_duration_minutes: 'Average Duration (min)',
    over60_count: 'Over 60 min',
    waiter_performance: 'Waiter Performance',
    product_performance: 'Product Performance',
    group_performance: 'Group Performance',
    open_closed_total: 'Open and Closed Orders',
    closed_total: 'Closed Orders',
    open_orders: 'Open Orders',
    closed_orders: 'Closed Orders',
    discount: 'Discount',
    branch: 'Branch',
    online: 'online',
    offline: 'offline',
    count_orders: 'orders',
    filter_table_no: 'Table No',
    date: 'Date',
    payment: 'Payment',
    waiter: 'Waiter',
    opening: 'Opening',
    closing: 'Closing',
    customer: 'Customer',
    duration: 'Duration',
    elapsed: 'Elapsed',
    not_found: 'No records found',
    load_more: 'Load More',
    showing: 'showing',
    page: 'Page',
    search_product: 'Search product',
    amount: 'Amount',
    quantity: 'Quantity',
    average_label: 'Average',
    total_sales: 'Total Sales',
    product_types: 'Product Types',
    all_products: 'All Products',
    products: 'Products',
    no_products: 'No products found',
    period_no_sales_products: 'No sales found for this period',
    groups: 'Groups',
    payments_title: 'Payment Types',
    total_payment: 'Total Payment',
    payment_types_desc: 'Analyze by payment methods',
    payment_types_count: 'payment types',
    distribution: 'Distribution',
    detailed_info: 'Detailed Info',
    transaction: 'transaction',
    sales_chart: 'Sales Chart',
    sales_chart_desc: 'Visualize sales trends',
    product_sales: 'Product-Based Sales',
    product_sales_desc: 'See top-selling products',
    daily_sales_chart: 'Daily Sales Chart',
    daily_details: 'Daily Details',
    no_data_selected_range: 'No data in selected date range',
    filter_title: 'Filter',
    table_no_label: 'Table No:',
    select: 'Select',
    clear_filters: 'Clear Filters',
    open_orders_title: 'Open Orders',
    order_detail: 'Order Detail',
    order_no: 'Order No',
    order_type: 'Order Type:',
    order_place: 'Order Place:',
    order_type_adisyon: 'Order',
    order_type_paket: 'Package',
    order_type_hizli: 'Quick Sale',
    subtotal: 'Subtotal',
    total_paid: 'Total Paid',
    cancelled_report_title: 'Cancellation, Return and Compliment Report',
    cancelled_report_desc: 'Review cancellation, return and compliment records',
    total_cancelled_amount: 'Total Cancelled Quantity',
    total_cancelled_count: 'cancellations',
    all: 'All',
    cancel: 'Cancel',
    return: 'Return',
    compliment: 'Compliment',
    all_cancellations: 'All Cancellations',
    no_cancellations_title: 'No Cancellations!',
    no_cancellations_text: 'No cancelled items for this period',
    info: 'Info',
    no_order_info: 'No order info for this record',
    groups_not_found: 'No groups found',
    start_date: 'Start Date',
    end_date: 'End Date',
    courier_tracking_report: 'Courier Tracking Report',
    courier_tracking_desc: 'Courier departure and return times tracking',
    courier: 'Courier',
    departure: 'Departure',
    return_time: 'Return',
    duration_min: 'Duration (min)',
    status: 'Status',
    on_road: 'On Road',
    returned: 'Returned',
    branch_management: 'Branch Management',
    select_branch: 'Select Branch',
    no_branch: 'No Branch',
    other_reports: 'Other Reports',
    personnel: 'Staff',
    personnel_desc: 'Waiter performance',
    payment_types_card_desc: 'Cash, Credit Card',
    hourly_sales: 'Hourly Sales',
    hourly_sales_desc: 'Peak hours of the day',
    cancelled_items: 'Cancel, Return and Compliment',
    cancelled_items_desc: 'Cancelled, returned and compliments',
    product_groups: 'Product Groups',
    product_groups_desc: 'Category based',
    courier_tracking_card_desc: 'Package durations',
    branch_selection: 'Branch Selection',
    select_date_range: 'Select Date Range',
    apply: 'Apply',
    table: 'Table',
    closing_time: 'Closing',
    date_label: 'DATE',
    time_label: 'TIME',
    waiter_label: 'WAITER',
    orders_title: 'Orders',
    item_count: 'Item',
    piece: 'pcs',
    person_count: 'Person Count',
    payment_method: 'Payment Method',
    loading: 'Loading...',
    edit_branch: 'Edit Branch',
    add_new_branch: 'Add New Branch',
    branch_name: 'Branch Name',
    host: 'Host',
    port: 'Port',
    db_name: 'DB Name',
    kasa_no: 'Register No',
    db_user: 'DB User',
    db_password: 'DB Password',
    save: 'Save',
    operation_failed: 'Operation failed.',
    confirm_delete_branch: 'Are you sure you want to delete this branch?',
    delete_failed: 'Deletion failed.',
    courier_tracking: 'Courier Tracking',
    product_group_sales: 'Product Group Sales',
    product_group: 'Product Group',
    product_name: 'Product Name',
    total_orders: 'total orders',
    basket_average: 'basket average',
    average_duration: 'average duration',
    long_duration: 'long duration',
    orders: 'Orders',
    performance_short: 'Perf.',
    product: 'Product',
    group: 'Group',
    distribution_chart: 'Distribution Chart',
    sales_chart_title: 'Sales Chart',
    sales_chart_subtitle: 'Time-based sales performance',
    reason: 'Reason',
    type: 'Type',
    login_failed: 'Login failed. Please check your credentials.',
    wrong_password: 'Wrong password',
    user_not_found: 'User not found',
    register: 'Register',
    discount_title: 'Discount Report',
    total_discount: 'Total Discount',
    no_discounts: 'No discounts found',
    discount_records: 'discount records',
    order_total: 'Order Total',
    net_total: 'Net Total',
    close: 'Close',
    time: 'Time',
    discount_report: 'Discount Report',
    discount_report_desc: 'Discounted orders',
    unpayable_report: 'Unpayable Report',
    unpayable_report_desc: 'Unpayable orders',
    debts_report: 'Debts',
    debts_report_desc: 'Orders added to debt',
    quick_stats: 'Quick Stats',
    view_details: 'View Details',
  }
};

interface I18nContextType {
  lang: Lang;
  setLang: (l: Lang) => void;
  t: (k: string) => string;
  formatCurrency: (amount: number) => string;
  formatDate: (date: string | Date) => string;
  formatTime: (time: string) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const I18nProvider = ({ children }: { children: React.ReactNode }) => {
  const [lang, setLangState] = useState<Lang>('tr');

  useEffect(() => {
    const saved = localStorage.getItem('lang') as Lang;
    if (saved === 'en' || saved === 'tr') setLangState(saved);
  }, []);

  const setLang = (l: Lang) => {
    setLangState(l);
    localStorage.setItem('lang', l);
  };

  const t = (k: string) => dict[lang][k] ?? k;

  const formatCurrency = (amount: number): string => {
    return new Intl.NumberFormat('tr-TR', {
      style: 'currency',
      currency: 'TRY',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(amount);
  };

  const formatDate = (date: string | Date): string => {
    const d = typeof date === 'string' ? new Date(date) : date;
    return d.toLocaleDateString('tr-TR', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    });
  };

  const formatTime = (time: string): string => {
    if (!time) return '';
    // Time format: HH:MM:SS
    const parts = time.split(':');
    if (parts.length >= 2) {
      return `${parts[0]}:${parts[1]}`;
    }
    return time;
  };

  return (
    <I18nContext.Provider value={{ lang, setLang, t, formatCurrency, formatDate, formatTime }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
};
